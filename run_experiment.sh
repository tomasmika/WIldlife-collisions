# Script to run simulations based on a file generated by generate_experiment.sh.
#
# The output consists of CSV files within a directory with a file named after
# {n-fences}-{n-passages}.csv having the output of netlogo-headless for a
# simulation of parameter 'count animals'.
#
# Usage:
# run_experiment.sh [-h netlogo_headless_name] [-j num_threads]
#  [-o output_directory] [-s setup_file]
# with the following definitions:
# - netlogo_headless_name: the full name to the netlogo-headless program to use
# - num_threads: the number of threads to use within the netlogo-headless
#   program (default: 1)
# - output_directory: the directory to write the output files to (for which a
#   leading slash needs to be included) (default: experiments-output/)
# - setup_file: the file to read the input from, or - for standard input
#   (default: experiments-setups.xml)

set -e

while getopts :s:h:j:o: name; do
	case $name in
	h)	netlogo_headless_name="$OPTARG";;
	j)	num_threads="$OPTARG";;
	o)	output_directory="$OPTARG";;
	s)	setup_file="$OPTARG";;
	:)	printf "Option -%c requires an operand\n" "$OPTARG"
		exit 1;;
	?)	printf "Usage: %s [-j num_threads] -h netlogo_headless_name [-o output_directory] [-s setup_file]\n" "$0"
		exit 1;;
  esac
done

if [ -z "$netlogo_headless_name" ]; then
	printf "No name to netlogo-headless specified.\n"
	exit 1
fi

if [ -z "$num_threads" ]; then
	num_threads=1
fi

if [ -z "$output_directory" ]; then
	output_directory="experiments-output/"
fi

if [ -z "$setup_file" ]; then
	setup_file="experiments-setups.xml"
fi

rm -rf -- "$output_directory"
mkdir -- "$output_directory"

for n_fences in 0 6 12 18 24; do
	for n_passages in 0 6 12 18 24; do
		"$netlogo_headless_name" --model 'Wildlife Collisions'.nlogo --setup-file "$setup_file" --experiment $n_fences-$n_passages --threads "$num_threads" --table "$output_directory$n_fences-$n_passages.csv"
	done
done
